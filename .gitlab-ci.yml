stages:
  - install
  - lint
  - test
  - deploy

variables:
  GIT_SUBMODULE_STRATEGY: recursive

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - venv/
    - ~/.cache/pip

install-job:
  stage: install
  script:
    - apt-get update
    - apt-get install -y python3-pip
    - pip install -r requirements.txt

lint-job:
  stage: lint
  script:
    - flake8
  dependencies:
    - install-job

test-job:
  stage: test
  script:
    - coverage run -m unittest
    - coverage report
  dependencies:
    - install-job
  artifacts:
    paths:
      - coverage_html/

deploy-job:
  stage: deploy
  script:
    - echo "Pipeline finished!"
  only:
    - main
